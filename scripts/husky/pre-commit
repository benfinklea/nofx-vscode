#!/bin/sh

# Pre-commit hook for NofX VS Code Extension
# Validates build before allowing commits

echo "üîç Running pre-commit validation..."

# Run TypeScript compilation
echo "üì¶ Compiling TypeScript..."
npm run compile || {
    echo "‚ùå TypeScript compilation failed. Please fix errors before committing."
    exit 1
}

# Validate build output
echo "‚úÖ Validating build..."
./scripts/validate-build.sh --quiet || {
    echo "‚ùå Build validation failed. Please fix errors before committing."
    exit 1
}

# Run quick tests for command registration (if available)
echo "üß™ Running command registration tests..."
if [ -f "src/test/unit/commands/CommandRegistration.test.ts" ]; then
    npm run test:commands 2>/dev/null || {
        echo "‚ö†Ô∏è  Command registration tests failed. Continuing anyway..."
    }
else
    echo "‚ö†Ô∏è  Command registration tests not yet available. Skipping..."
fi

# Check for console.log statements (portable for macOS and Linux)
echo "üîç Checking for console.log statements..."
if find src/ -name "*.ts" -not -path "*/test/*" -type f | xargs grep -l "console\.log" > /dev/null 2>&1; then
    echo "‚ö†Ô∏è  Warning: console.log statements found in source code"
    echo "   Consider using the LoggingService instead"
fi

echo "‚úÖ Pre-commit validation passed!"
